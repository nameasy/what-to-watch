Vue.createApp({data:()=>({movies:[],savedMovies:[],movieTitle:"",movieType:"",movieYear:"",movieGenre:"",movieCountry:"",selectedCountry:"",selectedGenre:"",selectedType:"",selectedYear:"",showFilters:!1,showSaves:!1,randomMovieAnimate:!1,saveMovieAnimate:!1,showResetButton:!1}),computed:{isSavedMovie(){return this.savedMovies.includes(this.movieTitle)},hasSavedMovies(){return this.savedMovies.length>0},savedMovieCount(){return this.savedMovies.length},uniqueCountries(){return Array.from(new Set(this.movies.flatMap(e=>e.country.split(", "))))},uniqueGenres(){return Array.from(new Set(this.movies.flatMap(e=>e.genre.split(", "))))},uniqueTypes(){return Array.from(new Set(this.movies.map(e=>e.type)))},uniqueYears(){return Array.from(new Set(this.movies.flatMap(e=>e.year.split("-"))))}},created(){document.addEventListener("keydown",e=>{"Escape"===e.key&&(this.closeFilters(),this.closeSaves())})},mounted(){this.fetchMovies(),this.savedMovies=JSON.parse(localStorage.getItem("savedMovies"))||[]},methods:{fetchMovies(){fetch("./data.json").then(e=>e.json()).then(e=>{let{movies:t}=e;this.movies=t,this.randomMovie()}).catch(e=>{console.error(e)})},randomMovie(){let e=this.movies.filter(e=>{let t=""===this.selectedType||e.type===this.selectedType,s=""===this.selectedYear||e.year.includes(this.selectedYear),i=""===this.selectedGenre||e.genre.includes(this.selectedGenre),o=""===this.selectedCountry||e.country.includes(this.selectedCountry);return t&&s&&i&&o});if(this.updateSelectOptions(e,"type","type"),this.updateSelectOptions(e,"year","year"),this.updateSelectOptions(e,"genre","genre"),this.updateSelectOptions(e,"country","country"),e.length>0){let t=Math.floor(Math.random()*e.length),{title:s,type:i,year:o,genre:r,country:a}=e[t];this.movieTitle=s,this.movieType=i,this.movieYear=o,this.movieGenre=r,this.movieCountry=a,this.randomMovieAnimate=!0}else this.movieTitle="Ничего не нашлось (·_·)"},updateSelectOptions(e,t,s){Array.from(document.getElementById(t).options).forEach(t=>{if(""===t.value)return;let i=e.some(e=>e[s].includes(t.value));t.disabled=!i})},saveMovie(){"Ничего не нашлось (·_·)"===this.movieTitle?alert("Фильмы не найдены"):this.savedMovies.includes(this.movieTitle)?alert("Фильм уже сохранён"):(this.savedMovies.push(this.movieTitle),localStorage.setItem("savedMovies",JSON.stringify(this.savedMovies)),this.saveMovieAnimate=!0)},deleteMovie(e){this.savedMovies.splice(e,1),localStorage.setItem("savedMovies",JSON.stringify(this.savedMovies))},updateFilters(){this.randomMovie(),this.showResetButton=""!==this.selectedType||""!==this.selectedYear||""!==this.selectedGenre||""!==this.selectedCountry},resetFilters(){this.selectedType="",this.selectedYear="",this.selectedGenre="",this.selectedCountry="",this.randomMovie(),this.showResetButton=!1},removeClass(e){this[e]=!1},openFilters(){this.showFilters=!0,document.querySelector("body").style.backgroundColor="var(--color-bg-dark)"},openSaves(){this.showSaves=!0,document.querySelector("body").style.backgroundColor="var(--color-bg-dark)"},closeFilters(){this.showFilters=!1,document.querySelector("body").style.removeProperty("background-color")},closeSaves(){this.showSaves=!1,document.querySelector("body").style.removeProperty("background-color")}}}).mount(".page");